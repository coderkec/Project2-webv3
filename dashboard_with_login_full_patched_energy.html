<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team2 í†µí•© ê´€ì œ ì‹œìŠ¤í…œ v4.3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* [ê¸°ì¡´ v4.2 ìŠ¤íƒ€ì¼ + ì§€ì—­ ì„ íƒ ë ˆì´ì•„ì›ƒ] */
        :root {
            --bg-color: #f8fafc; --card-bg: #ffffff; --text-main: #1e293b; --text-sub: #64748b; --border: #e2e8f0; --accent: #8b5cf6; --shadow: rgba(0, 0, 0, 0.05);
        }
        body.dark-mode {
            --bg-color: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9; --text-sub: #94a3b8; --border: #334155; --shadow: rgba(0, 0, 0, 0.3);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; transition: 0.3s; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-color); color: var(--text-main); padding: 20px; }
        
        /* ë¡œê·¸ì¸ í™”ë©´ */
        #loginView { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-shell { width: 100%; max-width: 1000px; display: grid; grid-template-columns: 1.2fr 0.8fr; background: var(--card-bg); border-radius: 24px; overflow: hidden; box-shadow: 0 20px 40px var(--shadow); }
        .login-hero { padding: 60px; color: white; background: linear-gradient(135deg, #4338ca 0%, #7c3aed 100%); }
        .login-hero h1 { font-size: 42px; font-weight: 900; margin-bottom: 20px; }
        .login-panel { padding: 50px; }
        .login-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 15px; }

        /* ëŒ€ì‹œë³´ë“œ UI */
        .container { max-width: 900px; margin: 80px auto 20px; }
        .region-bar { display: flex; justify-content: flex-end; align-items: center; gap: 10px; margin-bottom: 20px; }
        #regionSelect { padding: 10px 15px; border-radius: 10px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-main); font-weight: 700; cursor: pointer; outline: none; box-shadow: 0 4px 10px var(--shadow); }
        
        .info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .info-card { background: var(--card-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--border); cursor: pointer; box-shadow: 0 4px 12px var(--shadow); }
        .info-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .info-title { font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 10px; display: flex; justify-content: space-between; }
        .info-value { font-size: 22px; font-weight: 800; color: var(--text-main); }
        .badge { font-size: 10px; padding: 3px 7px; border-radius: 4px; background: rgba(139, 92, 246, 0.1); color: var(--accent); }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); }
        .modal-content { background: var(--card-bg); margin: 5% auto; padding: 30px; border-radius: 24px; width: 90%; max-width: 700px; position: relative; border: 1px solid var(--border); }
        .chart-box { width: 100%; height: 300px; margin-top: 20px; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="dark-mode">

    <div id="loginView">
        <div class="login-shell">
            <div class="login-hero">
                <h1>AI + API ê¸°ë°˜ ì‚¬ì´íŠ¸</h1>
                <p>Kubernetes ê¸°ë°˜ ì¸í”„ë¼ ê´€ì œ ë° ì‹¤ì‹œê°„<br>ë‚ ì”¨, ì „ë ¥, í™˜ìœ¨ ë°ì´í„°ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.</p>
                <div style="margin-top:30px;"><span style="background:rgba(255,255,255,0.2); padding:8px 15px; border-radius:99px; font-size:13px; font-weight:700;">ğŸš€ v4.3 Infrastructure Control</span></div>
            </div>
            <div class="login-panel">
                <h2 style="margin-bottom:10px;">í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹</h2>
                <p style="color:var(--text-sub); font-size:14px; margin-bottom:25px;">ì‹œìŠ¤í…œ ì ‘ì†ì„ ìœ„í•´ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.</p>
                <input type="text" id="loginUser" class="login-input" placeholder="ì•„ì´ë””">
                <input type="password" id="loginPass" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
                <button id="btnLogin" style="width:100%; padding:15px; background:var(--accent); color:white; border:none; border-radius:10px; font-weight:700; cursor:pointer;">ê´€ì œ ì‹œìŠ¤í…œ ì ‘ì†</button>
                <div style="display:flex; justify-content:space-between; margin-top:20px; font-size:13px; color:var(--accent); font-weight:700;">
                    <span style="cursor:pointer;">íšŒì›ê°€ì…</span><span style="cursor:pointer;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</span>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardView" class="hidden">
        <div class="container">
            <div class="region-bar">
                <span style="font-size: 14px; font-weight: 800;">ğŸ“ ì§€ì—­ ê´€ì œ ëŒ€ìƒ:</span>
                <select id="regionSelect" onchange="changeRegion()">
                    <option value="seoul">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                    <option value="busan">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                    <option value="incheon">ì¸ì²œê´‘ì—­ì‹œ</option>
                    <option value="daegu">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                    <option value="gwangju">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                    <option value="daejeon">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                </select>
            </div>

            <div class="info-grid">
                <div class="info-card" onclick="openModal('weather')">
                    <div class="info-title">ë‚ ì”¨ <span class="badge">ê¸°ìƒì²­</span></div>
                    <div class="info-value" id="weatherValue">--Â°C</div>
                    <div id="weatherSub" style="font-size:12px; color:var(--text-sub); margin-top:5px;">ì„œìš¸ (ê´€ì œ ì¤‘)</div>
                </div>
                <div class="info-card" onclick="openModal('energy')">
                    <div class="info-title">ì „ë ¥(KPX) <span class="badge">ë¶€í•˜ëŸ‰</span></div>
                    <div class="info-value" id="energyValue">-- MW</div>
                    <div id="energySub" style="font-size:12px; color:var(--text-sub); margin-top:5px;">ì§€ì—­ë³„ ì „ë ¥ ë°ì´í„°</div>
                </div>
                <div class="info-card" onclick="openModal('fx')">
                    <div class="info-title">í™˜ìœ¨ <span class="badge">USD/KRW</span></div>
                    <div class="info-value" id="fxValue">1460.19</div>
                    <div style="font-size:12px; color:var(--text-sub); margin-top:5px;">ì‹¤ì‹œê°„ í™˜ìœ¨ ì •ë³´</div>
                </div>
                <div class="info-card" onclick="openModal('time')">
                    <div class="info-title">ì‹œê°„ <span class="badge">Asia/Seoul</span></div>
                    <div class="info-value" id="timeValue">16:59</div>
                    <div id="timeSub" style="font-size:12px; color:var(--text-sub); margin-top:5px;">2026. 02. 10.</div>
                </div>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal">
        <div class="modal-content">
            <span style="position:absolute; right:25px; top:20px; font-size:24px; cursor:pointer;" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="margin-bottom:20px;">ìƒì„¸ ë°ì´í„° ë¶„ì„</h2>
            <div id="modalBody" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
            <div class="chart-box"><canvas id="detailChart"></canvas></div>
        </div>
    </div>

    <script>
        const AUTH_KEY = "team2_auth_v1";
        let detailChart = null;

        /* [ì§€ì—­ ë°ì´í„° ë§µ] */
        const REGION_MAP = {
            "seoul":   { name: "ì„œìš¸", nx: 60, ny: 127, energyKey: "ì„œìš¸" },
            "busan":   { name: "ë¶€ì‚°", nx: 98, ny: 76,  energyKey: "ë¶€ì‚°" },
            "incheon": { name: "ì¸ì²œ", nx: 55, ny: 124, energyKey: "ì¸ì²œ" },
            "daegu":   { name: "ëŒ€êµ¬", nx: 89, ny: 90,  energyKey: "ëŒ€êµ¬" },
            "gwangju": { name: "ê´‘ì£¼", nx: 58, ny: 74,  energyKey: "ê´‘ì£¼" },
            "daejeon": { name: "ëŒ€ì „", nx: 67, ny: 100, energyKey: "ëŒ€ì „" }
        };

        /* [ì§€ì—­ ë³€ê²½ ì‹œ ë™ì‘] */
        async function changeRegion() {
            const key = document.getElementById("regionSelect").value;
            const region = REGION_MAP[key];
            
            // ë‚ ì”¨ & ì „ë ¥ ë¡œë“œ
            loadWeather(region.nx, region.ny, region.name);
            loadEnergy(region.energyKey);
        }

        async function loadWeather(nx, ny, name) {
            try {
                const res = await fetch(`/api/weather/short?nx=${nx}&ny=${ny}`);
                const data = await res.json();
                const temp = Math.round(data.hourly[0].TMP);
                document.getElementById("weatherValue").innerText = (temp > 0 ? "+" : "") + temp + "Â°C";
                document.getElementById("weatherSub").innerText = name + " (ì‹¤ì‹œê°„ ê´€ì œ)";
            } catch (e) { document.getElementById("weatherValue").innerText = "N/A"; }
        }

        async function loadEnergy(energyKey) {
            try {
                const res = await fetch(`/api/energy/kpx/now?page=1&perPage=2`);
                const json = await res.json();
                const usage = json.data[0][energyKey];
                document.getElementById("energyValue").innerText = usage + " MW";
                document.getElementById("energySub").innerText = energyKey + " ì§€ì—­ ì‹¤ì‹œê°„ ë¶€í•˜";
            } catch (e) { document.getElementById("energyValue").innerText = "N/A"; }
        }

        // --- ëª¨ë‹¬ & ê·¸ë˜í”„ ë¡œì§ ---
        function openModal(type) {
            document.getElementById("detailModal").style.display = "block";
            const ctx = document.getElementById('detailChart').getContext('2d');
            if(detailChart) detailChart.destroy();
            
            // ì˜ˆì‹œ ê·¸ë˜í”„ ë°ì´í„°
            detailChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1ì¼ì „', '2ì¼ì „', '3ì¼ì „', '4ì¼ì „', '5ì¼ì „', '6ì¼ì „', 'ì˜¤ëŠ˜'],
                    datasets: [{ label: type.toUpperCase() + ' ì¶”ì´', data: [12, 19, 13, 15, 22, 20, 25], borderColor: '#8b5cf6', tension: 0.4 }]
                }
            });
        }
        function closeModal() { document.getElementById("detailModal").style.display = "none"; }

        // --- ì´ˆê¸°í™” ---
        document.getElementById("btnLogin").onclick = () => {
            const u = document.getElementById("loginUser").value, p = document.getElementById("loginPass").value;
            if(u === "admin" && p === "admin123") {
                localStorage.setItem(AUTH_KEY, "true");
                location.reload();
            } else { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨!"); }
        };

        window.onload = () => {
            if(localStorage.getItem(AUTH_KEY)) {
                document.getElementById("loginView").classList.add("hidden");
                document.getElementById("dashboardView").classList.remove("hidden");
                changeRegion(); // ê¸°ë³¸ 'ì„œìš¸' ë°ì´í„° ë¡œë“œ
            }
        };
    </script>
</body>
</html>